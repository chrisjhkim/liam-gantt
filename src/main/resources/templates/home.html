<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/base :: head"></head>
<body>
    <nav th:replace="layout/base :: nav"></nav>

    <main class="container-fluid mt-4">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">
                <i class="fas fa-tachometer-alt me-2"></i>
                대시보드
            </h1>
            <div>
                <a th:href="@{/web/projects/new}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>새 프로젝트
                </a>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="card bg-primary text-white mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="text-white-75">전체 프로젝트</div>
                                <div class="h2 mb-0" th:text="${totalProjects ?: 0}">0</div>
                            </div>
                            <div>
                                <i class="fas fa-project-diagram fa-2x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" th:href="@{/web/projects}">
                            자세히 보기
                        </a>
                        <div class="small text-white">
                            <i class="fas fa-angle-right"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card bg-success text-white mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="text-white-75">진행 중인 프로젝트</div>
                                <div class="h2 mb-0" th:text="${activeProjects ?: 0}">0</div>
                            </div>
                            <div>
                                <i class="fas fa-play-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" th:href="@{/web/projects?status=IN_PROGRESS}">
                            자세히 보기
                        </a>
                        <div class="small text-white">
                            <i class="fas fa-angle-right"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card bg-info text-white mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="text-white-75">완료된 프로젝트</div>
                                <div class="h2 mb-0" th:text="${completedProjects ?: 0}">0</div>
                            </div>
                            <div>
                                <i class="fas fa-check-circle fa-2x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" th:href="@{/web/projects?status=COMPLETED}">
                            자세히 보기
                        </a>
                        <div class="small text-white">
                            <i class="fas fa-angle-right"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card bg-warning text-white mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="text-white-75">완료율</div>
                                <div class="h2 mb-0">
                                    <span th:if="${totalProjects > 0}" th:text="${#numbers.formatDecimal(completedProjects * 100.0 / totalProjects, 1, 1)} + '%'">0%</span>
                                    <span th:if="${totalProjects == 0}">0%</span>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-chart-pie fa-2x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" th:href="@{/web/gantt}">
                            간트차트 보기
                        </a>
                        <div class="small text-white">
                            <i class="fas fa-angle-right"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Projects -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-clock me-2"></i>최근 프로젝트
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${recentProjects != null and !recentProjects.isEmpty()}">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>프로젝트명</th>
                                            <th>상태</th>
                                            <th>진행률</th>
                                            <th>시작일</th>
                                            <th>액션</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="project : ${recentProjects}">
                                            <td>
                                                <div>
                                                    <h6 class="mb-1" th:text="${project.name}"></h6>
                                                    <small class="text-muted" th:text="${#strings.abbreviate(project.description, 50)}"></small>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge" 
                                                      th:classappend="${project.status.name() == 'IN_PROGRESS' ? 'bg-primary' : 
                                                                      project.status.name() == 'COMPLETED' ? 'bg-success' :
                                                                      project.status.name() == 'PLANNING' ? 'bg-secondary' :
                                                                      project.status.name() == 'ON_HOLD' ? 'bg-warning' : 'bg-danger'}"
                                                      th:text="${project.status.name() == 'PLANNING' ? '계획' :
                                                               project.status.name() == 'IN_PROGRESS' ? '진행중' :
                                                               project.status.name() == 'COMPLETED' ? '완료' :
                                                               project.status.name() == 'ON_HOLD' ? '보류' : '취소'}">
                                                </span>
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress me-2" style="width: 80px;">
                                                        <div class="progress-bar" 
                                                             th:style="'width: ' + ${project.averageProgress} + '%'"
                                                             th:classappend="${project.averageProgress >= 100 ? 'bg-success' :
                                                                             project.averageProgress >= 75 ? 'bg-info' :
                                                                             project.averageProgress >= 50 ? 'bg-warning' : 'bg-danger'}">
                                                        </div>
                                                    </div>
                                                    <small th:text="${#numbers.formatDecimal(project.averageProgress, 1, 1)} + '%'"></small>
                                                </div>
                                            </td>
                                            <td th:text="${#temporals.format(project.startDate, 'MM-dd')}"></td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <a th:href="@{/web/projects/{id}(id=${project.id})}" 
                                                       class="btn btn-outline-primary" title="상세보기">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a th:href="@{/web/gantt/{id}(id=${project.id})}" 
                                                       class="btn btn-outline-success" title="간트차트">
                                                        <i class="fas fa-chart-gantt"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="text-center mt-3">
                                <a th:href="@{/web/projects}" class="btn btn-outline-primary">
                                    <i class="fas fa-list me-2"></i>모든 프로젝트 보기
                                </a>
                            </div>
                        </div>
                        
                        <div th:if="${recentProjects == null or recentProjects.isEmpty()}" class="text-center py-4">
                            <i class="fas fa-project-diagram fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">등록된 프로젝트가 없습니다</h6>
                            <p class="text-muted">첫 번째 프로젝트를 만들어보세요.</p>
                            <a th:href="@{/web/projects/new}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>프로젝트 만들기
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bolt me-2"></i>빠른 액션
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a th:href="@{/web/projects/new}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>새 프로젝트 만들기
                            </a>
                            <a th:href="@{/web/projects}" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>프로젝트 목록
                            </a>
                            <a th:href="@{/web/gantt}" class="btn btn-outline-success">
                                <i class="fas fa-chart-gantt me-2"></i>간트차트 보기
                            </a>
                        </div>
                    </div>
                </div>

                <!-- System Info -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-info-circle me-2"></i>시스템 정보
                        </h5>
                    </div>
                    <div class="card-body">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">버전:</dt>
                            <dd class="col-sm-6">1.0.0</dd>
                            
                            <dt class="col-sm-6">마지막 업데이트:</dt>
                            <dd class="col-sm-6" th:text="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"></dd>
                            
                            <dt class="col-sm-6">개발자:</dt>
                            <dd class="col-sm-6">Liam</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="layout/base :: footer"></footer>

    <script th:replace="layout/base :: scripts"></script>
    <script>
        // Dashboard specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Animate progress bars
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.transition = 'width 1s ease-in-out';
                    bar.style.width = width;
                }, 100);
            });
            
            // Add hover effect to cards
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>